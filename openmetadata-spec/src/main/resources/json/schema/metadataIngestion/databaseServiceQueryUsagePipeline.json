{
  "$id": "https://open-metadata.org/schema/metadataIngestion/databaseServiceQueryUsagePipeline.json",
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "DatabaseServiceQueryUsagePipeline",
  "description": "DatabaseService Query Usage Pipeline Configuration.",
  "type": "object",
  "definitions": {
    "databaseUsageConfigType": {
      "description": "Database Source Config Usage Pipeline type",
      "type": "string",
      "enum": ["DatabaseUsage"],
      "default": "DatabaseUsage"
    },
    "lineageParserType": {
      "description": "Type of parser to use for SQL lineage extraction. SQLGlot is recommended for best accuracy and performance.",
      "type": "string",
      "enum": ["sqlglot", "sqlfluff", "sqlparse", "auto"],
      "default": "sqlglot"
    }
  },
  "properties": {
    "type": {
      "description": "Pipeline type",
      "$ref": "#/definitions/databaseUsageConfigType",
      "default": "DatabaseUsage"
    },
    "queryLogDuration": {
      "description": "Configuration to tune how far we want to look back in query logs to process usage data.",
      "type": "integer",
      "default": 1,
      "title": "Query Log Duration"
    },
    "stageFileLocation": {
      "description": "Temporary file name to store the query logs before processing. Absolute file path required.",
      "type": "string",
      "default": "/tmp/query_log",
      "title": "Stage File Location"
    },
    "filterCondition": {
      "description": "Configuration the condition to filter the query history.",
      "type": "string",
      "title": "Filter Condition"
    },
    "resultLimit": {
      "description": "Configuration to set the limit for query logs",
      "type": "integer",
      "default": 1000,
      "title": "Result Limit"
    },
    "queryLogFilePath": {
      "description": "Configuration to set the file path for query logs",
      "type": "string",
      "title": "Query Log File Path"
    },
    "processQueryCostAnalysis": {
      "description": "Configuration to process query cost",
      "type": "boolean",
      "default": true,
      "title": "Process Query Cost"
    },
    "parserType": {
      "title": "Lineage Parser Type",
      "description": "Type of SQL parser to use for lineage extraction. Options: 'sqlglot' (default, recommended for best accuracy), 'sqlfluff' (legacy, may have parsing issues), 'sqlparse' (generic fallback), 'auto' (tries sqlglot first, falls back to sqlparse).",
      "$ref": "#/definitions/lineageParserType",
      "default": "sqlglot"
    }
  },
  "additionalProperties": false
}
