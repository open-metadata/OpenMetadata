{
  "$id": "https://open-metadata.org/schema/governance/workflows/elements/nodes/automatedTask/sinkTask.json",
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "SinkTaskDefinition",
  "description": "Pushes entity data to an external sink destination such as Git repositories, webhooks, or HTTP endpoints.",
  "javaInterfaces": [
    "org.openmetadata.schema.governance.workflows.elements.WorkflowNodeDefinitionInterface"
  ],
  "javaType": "org.openmetadata.schema.governance.workflows.elements.nodes.automatedTask.SinkTaskDefinition",
  "type": "object",
  "definitions": {
    "sinkType": {
      "title": "Sink Type",
      "description": "Type of sink destination.",
      "type": "string",
      "enum": ["git", "webhook", "httpEndpoint"]
    },
    "syncMode": {
      "title": "Sync Mode",
      "description": "How entities should be synchronized to the sink.",
      "type": "string",
      "enum": ["append", "overwrite", "merge"],
      "default": "overwrite"
    },
    "outputFormat": {
      "title": "Output Format",
      "description": "Format for serialized entity output.",
      "type": "string",
      "enum": ["yaml", "json"],
      "default": "yaml"
    },
    "entityFilter": {
      "title": "Entity Filter",
      "description": "Optional filter to select specific entities or entity types.",
      "type": "object",
      "properties": {
        "entityTypes": {
          "title": "Entity Types",
          "description": "Filter entities by type (e.g., table, dashboard, glossaryTerm).",
          "type": "array",
          "items": { "type": "string" }
        },
        "domains": {
          "title": "Domains",
          "description": "Filter entities by domain.",
          "type": "array",
          "items": { "type": "string" }
        },
        "tags": {
          "title": "Tags",
          "description": "Filter entities by tag.",
          "type": "array",
          "items": { "type": "string" }
        }
      },
      "additionalProperties": false
    },
    "hierarchyConfig": {
      "title": "Hierarchy Configuration",
      "description": "Configuration for maintaining asset hierarchy in output.",
      "type": "object",
      "properties": {
        "preserveHierarchy": {
          "title": "Preserve Hierarchy",
          "description": "Maintain entity hierarchy in directory structure.",
          "type": "boolean",
          "default": true
        },
        "rootPath": {
          "title": "Root Path",
          "description": "Base directory path for output files.",
          "type": "string",
          "default": "metadata"
        }
      },
      "additionalProperties": false
    }
  },
  "properties": {
    "type": {
      "type": "string",
      "default": "automatedTask"
    },
    "subType": {
      "type": "string",
      "default": "sinkTask"
    },
    "name": {
      "title": "Name",
      "description": "Name that identifies this Node.",
      "$ref": "../../../../../type/basic.json#/definitions/entityName"
    },
    "displayName": {
      "title": "Display Name",
      "description": "Display Name that identifies this Node.",
      "type": "string"
    },
    "description": {
      "title": "Description",
      "description": "Description of the Node.",
      "$ref": "../../../../../type/basic.json#/definitions/markdown"
    },
    "config": {
      "title": "Sink Task Configuration",
      "type": "object",
      "properties": {
        "sinkType": {
          "$ref": "#/definitions/sinkType"
        },
        "sinkConfig": {
          "title": "Sink Configuration",
          "description": "Inline sink-specific configuration. Schema depends on sinkType.",
          "type": "object"
        },
        "syncMode": {
          "$ref": "#/definitions/syncMode"
        },
        "outputFormat": {
          "$ref": "#/definitions/outputFormat"
        },
        "entityFilter": {
          "$ref": "#/definitions/entityFilter"
        },
        "hierarchyConfig": {
          "$ref": "#/definitions/hierarchyConfig"
        },
        "batchMode": {
          "title": "Batch Mode",
          "description": "If true, collect all entities and write in single operation (single git commit). If false, write each entity individually.",
          "type": "boolean",
          "default": true
        },
        "timeoutSeconds": {
          "title": "Timeout Seconds",
          "description": "Timeout in seconds for sink operations.",
          "type": "integer",
          "default": 300
        }
      },
      "required": ["sinkType"],
      "additionalProperties": false
    },
    "input": {
      "type": "array",
      "items": { "type": "string" },
      "default": ["relatedEntity"],
      "additionalItems": false,
      "minItems": 1
    },
    "inputNamespaceMap": {
      "type": "object",
      "properties": {
        "relatedEntity": {
          "type": "string",
          "default": "global"
        }
      },
      "additionalProperties": false,
      "required": ["relatedEntity"]
    },
    "output": {
      "title": "Output Variables",
      "description": "Variables this node outputs for use in subsequent nodes",
      "type": "array",
      "items": { "type": "string" },
      "default": ["syncResult", "syncedCount", "failedCount", "result"],
      "additionalItems": false
    },
    "branches": {
      "type": "array",
      "items": { "type": "string" },
      "default": ["success", "failure"],
      "additionalItems": false,
      "minItems": 2,
      "maxItems": 2
    }
  },
  "required": ["name", "config"],
  "additionalProperties": false
}
