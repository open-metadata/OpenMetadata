{
  "$id": "https://open-metadata.org/schema/entity/configuration/authenticationConfiguration.json",
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "AuthenticationConfiguration",
  "description": "This schema defines the Authentication Configuration.",
  "type": "object",
  "javaType": "org.openmetadata.schema.api.security.AuthenticationConfiguration",
  "definitions": {
    "responseType": {
      "javaType": "org.openmetadata.schema.api.security.ResponseType",
      "description": "Response Type",
      "type": "string",
      "enum": [
        "id_token",
        "code"
      ],
      "default": "id_token"
    }
  },
  "properties": {
    "clientType": {
      "title": "Client Type",
      "javaType": "org.openmetadata.schema.api.security.ClientType",
      "description": "Client Type",
      "type": "string",
      "enum": ["public", "confidential"],
      "enumNames": ["Public", "Confidential"],
      "default": "public"
    },
    "provider": {
      "title": "Provider",
      "$ref": "../entity/services/connections/metadata/openMetadataConnection.json#/definitions/authProvider"
    },
    "responseType": {
      "title": "Response Type",
      "description": "This is used by auth provider provide response as either id_token or code.",
      "$ref": "#/definitions/responseType"
    },
    "providerName": {
      "title": "Provider Name",
      "description": "Custom OIDC Authentication Provider Name",
      "type": "string"
    },
    "publicKeyUrls": {
      "title": "Public Key URLs",
      "description": "List of Public Key URLs",
      "type": "array",
      "items": {
        "type": "string"
      }
    },
    "tokenValidationAlgorithm": {
      "title": "Token Validation Algorithm",
      "description": "Token Validation Algorithm to use.",
      "type": "string",
      "enum": ["RS256", "RS384", "RS512", "ES256", "ES384", "ES512"],
      "default": "RS256"
    },
    "authority": {
      "title": "Authority",
      "description": "Authentication Authority",
      "type": "string"
    },
    "clientId": {
      "title": "Client ID",
      "description": "Client ID",
      "type": "string"
    },
    "callbackUrl": {
      "title": "Callback URL",
      "description": "Callback URL",
      "type": "string"
    },
    "jwtPrincipalClaims": {
      "title": "Jwt Principal Claims",
      "description": "Jwt Principal Claim",
      "type": "array",
      "items": {
        "type": "string"
      }
    },
    "jwtPrincipalClaimsMapping": {
      "title": "Jwt Principal Claims Mapping",
      "description": "Jwt Principal Claim Mapping. Format: 'key:claim_name' where key must be 'username' or 'email'. Both username and email mappings are required.",
      "type": "array",
      "items": {
        "type": "string",
        "pattern": "^(username|email):[a-zA-Z0-9_-]+$"
      }
    },
    "jwtTeamClaimMapping": {
      "title": "Jwt Team Claim Mapping",
      "description": "JWT claim name that contains team/department information. For SAML SSO, this is the attribute name (e.g., 'department') from the SAML assertion. For JWT, this is the claim name in the JWT token. The value from this claim will be used to automatically assign users to matching teams in OpenMetadata during login.",
      "type": "string"
    },
    "enableSelfSignup": {
      "title": "Enable Self Sign Up",
      "description": "Enable Self Sign Up",
      "type": "boolean",
      "default": false
    },
    "ldapConfiguration": {
      "title": "LDAP Configuration",
      "description": "LDAP Configuration in case the Provider is LDAP",
      "$ref": "./ldapConfiguration.json"
    },
    "samlConfiguration": {
      "title": "Saml Configuration",
      "description": "Saml Configuration that is applicable only when the provider is Saml",
      "$ref": "../security/client/samlSSOClientConfig.json"
    },
    "oidcConfiguration": {
      "title": "Oidc Configuration",
      "description": "Oidc Configuration for Confidential Client Type",
      "$ref": "../security/client/oidcClientConfig.json"
    },
    "forceSecureSessionCookie": {
      "description": "Force secure flag on session cookies even when not using HTTPS directly. Enable this when running behind a proxy/load balancer that handles SSL termination.",
      "type": "boolean",
      "default": false
    },
    "enableAutoRedirect": {
      "title": "Enable Auto Redirect",
      "description": "Enable automatic redirect from the sign-in page to the configured SSO provider.",
      "type": "boolean",
      "default": false
    }
  },
  "required": ["provider", "providerName", "jwtPrincipalClaims"],
  "allOf": [
    {
      "if": {
        "properties": {
          "provider": { "const": "ldap" }
        }
      },
      "then": {
        "required": ["ldapConfiguration"]
      }
    },
    {
      "if": {
        "properties": {
          "provider": { "const": "saml" }
        }
      },
      "then": {
        "required": ["samlConfiguration"]
      }
    },
    {
      "if": {
        "allOf": [
          {
            "properties": {
              "provider": {
                "enum": ["google", "azure", "okta", "auth0", "aws-cognito", "custom-oidc"]
              }
            }
          },
          {
            "properties": {
              "clientType": { "const": "public" }
            }
          }
        ]
      },
      "then": {
        "required": ["publicKeyUrls", "authority", "callbackUrl", "clientId"]
      }
    },
    {
      "if": {
        "allOf": [
          {
            "properties": {
              "provider": {
                "enum": ["google", "azure", "okta", "auth0", "aws-cognito", "custom-oidc"]
              }
            }
          },
          {
            "properties": {
              "clientType": { "const": "confidential" }
            }
          }
        ]
      },
      "then": {
        "required": ["authority", "callbackUrl", "clientId", "oidcConfiguration"]
      }
    }
  ],
  "additionalProperties": false
}
