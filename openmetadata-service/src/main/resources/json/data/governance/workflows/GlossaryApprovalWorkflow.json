{
  "name": "GlossaryTermApprovalWorkflow",
  "fullyQualifiedName": "GlossaryTermApprovalWorkflow",
  "displayName": "Glossary Term Approval Workflow",
  "description": "When a Glossary Term is Created or Updated, this Workflow will be triggered for the Term to be Approved.",
  "type": "eventBasedEntityWorkflow",
  "trigger": {
    "type": "eventBasedEntityWorkflow",
    "config": {
      "entityType": "glossaryTerm",
      "events": ["Created", "Updated"]
    }
  },
  "nodes": [
    {
      "type": "startEvent",
      "subType": "startEvent",
      "name": "GlossaryTermCreated",
      "displayName": "Glossary Term Created or Updated"
    },
    {
      "type": "endEvent",
      "subType": "endEvent",
      "name": "ApprovedEnd",
      "displayName": "Glossary Term Status: Approved"
    },
    {
      "type": "endEvent",
      "subType": "endEvent",
      "name": "RejectedEnd",
      "displayName": "Glossary Term Status: Rejected"
    },
    {
      "type": "endEvent",
      "subType": "endEvent",
      "name": "DraftEnd",
      "displayName": "Glossary Term Status: Draft"
    },
    {
      "type": "endEvent",
      "subType": "endEvent",
      "name": "NoOpEnd",
      "displayName": "Glossary Term Status Unchanged"
    },
    {
      "type": "automatedTask",
      "subType": "checkEntityAttributesTask",
      "name": "CheckUpdatedMoreThanReviewers",
      "displayName": "End Workflow if only Reviewers were updated",
      "config": {
        "rules": "{\"or\":[{\"some\":[{\"merge\":[{\"var\":\"changeDescription.fieldsAdded\"},{\"var\":\"changeDescription.fieldsUpdated\"},{\"var\":\"changeDescription.fieldsDeleted\"}]},{\"!=\":[{\"var\":\"name\"},\"reviewers\"]}]},{\"!\":[{\"!!\":[{\"merge\":[{\"var\":\"changeDescription.fieldsAdded\"},{\"var\":\"changeDescription.fieldsUpdated\"},{\"var\":\"changeDescription.fieldsDeleted\"}]}]}]}]}"
      }
    },
    {
      "type": "automatedTask",
      "subType": "checkEntityAttributesTask",
      "name": "CheckGlossaryTermHasReviewers",
      "displayName": "Check if Glossary Term has Reviewers",
      "config": {
        "rules": "{ \"!!\": [ { \"var\": \"reviewers\" } ] }"
      }
    },
    {
      "type": "automatedTask",
      "subType": "checkEntityAttributesTask",
      "name": "CheckGlossaryTermIsReadyToBeReviewed",
      "displayName": "Check if Glossary Term is Ready to be Reviewed",
      "config": {
        "rules": "{ \"in\": [ \"Bar\", { \"var\": \"extension.foo\" } ] }"
      }
    },
    {
      "type": "automatedTask",
      "subType": "setGlossaryTermStatusTask",
      "name": "SetGlossaryTermStatusToInReview",
      "displayName": "Set Status to 'In Review'",
      "config": {
        "glossaryTermStatus": "In Review"
      }
    },
    {
      "type": "automatedTask",
      "subType": "setGlossaryTermStatusTask",
      "name": "SetGlossaryTermStatusToDraft",
      "displayName": "Set Status to 'Draft'",
      "config": {
        "glossaryTermStatus": "Draft"
      }
    },
    {
      "type": "userTask",
      "subType": "userApprovalTask",
      "name": "ApproveGlossaryTerm",
      "displayName": "Create User Approval Task",
      "config": {
        "assignees": {
          "addReviewers": true
        }
      }
    },
    {
      "type": "automatedTask",
      "subType": "setGlossaryTermStatusTask",
      "name": "SetGlossaryTermStatusToApproved",
      "displayName": "Set Status to 'Approved'",
      "config": {
        "glossaryTermStatus": "Approved"
      }
    },
    {
      "type": "automatedTask",
      "subType": "setGlossaryTermStatusTask",
      "name": "SetGlossaryTermStatusToRejected",
      "displayName": "Set Status to 'Rejected'",
      "config": {
        "glossaryTermStatus": "Rejected"
      }
    }
  ],
  "edges": [
    {
      "from": "GlossaryTermCreated",
      "to": "CheckUpdatedMoreThanReviewers"
    },
    {
      "from": "CheckUpdatedMoreThanReviewers",
      "to": "NoOpEnd",
      "condition": "${!checkPassed}"
    },
    {
      "from": "CheckUpdatedMoreThanReviewers",
      "to": "CheckGlossaryTermHasReviewers",
      "condition": "${checkPassed}"
    },
    {
      "from": "CheckGlossaryTermHasReviewers",
      "to": "SetGlossaryTermStatusToApproved",
      "condition": "${!checkPassed}"
    },
    {
      "from": "CheckGlossaryTermHasReviewers",
      "to": "CheckGlossaryTermIsReadyToBeReviewed",
      "condition": "${checkPassed}"
    },
    {
      "from": "CheckGlossaryTermIsReadyToBeReviewed",
      "to": "SetGlossaryTermStatusToDraft",
      "condition": "${!checkPassed}"
    },
    {
      "from": "SetGlossaryTermStatusToDraft",
      "to": "DraftEnd"
    },
    {
      "from": "CheckGlossaryTermIsReadyToBeReviewed",
      "to": "SetGlossaryTermStatusToInReview",
      "condition": "${checkPassed}"
    },
    {
      "from": "SetGlossaryTermStatusToInReview",
      "to": "ApproveGlossaryTerm"
    },
    {
      "from": "ApproveGlossaryTerm",
      "to": "SetGlossaryTermStatusToApproved",
      "condition": "${approved}"
    },
    {
      "from": "ApproveGlossaryTerm",
      "to": "SetGlossaryTermStatusToRejected",
      "condition": "${!approved}"
    },
    {
      "from": "SetGlossaryTermStatusToApproved",
      "to": "ApprovedEnd"
    },
    {
      "from": "SetGlossaryTermStatusToRejected",
      "to": "RejectedEnd"
    }
  ]
}