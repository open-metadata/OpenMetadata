# Copyright 2026 Collate.
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
# http://www.apache.org/licenses/LICENSE-2.0
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
# ODCS Contract for sample_data.ecommerce_db.shopify.dim_customer
# This contract matches the dim_customer table from OpenMetadata sample data
# Use this when testing against the sample_data service
apiVersion: v3.1.0
kind: DataContract
id: dim-customer-contract
name: Dim Customer Data Contract
version: "1.0.0"
status: active
description:
  purpose: Data contract for the dim_customer dimension table containing customer metrics and segmentation
  usage: Use for customer analytics, segmentation, and lifetime value analysis
schema:
  - name: dim_customer
    logicalType: object
    physicalType: table
    description: Customer dimension table with historical and forward-looking metrics
    properties:
      - name: customer_id
        logicalType: integer
        required: true
        primaryKey: true
        description: The ID of the customer (primary key)
      - name: shop_id
        logicalType: integer
        required: true
        description: The ID of the store (foreign key to dim_shop)
      - name: average_order_size
        logicalType: number
        description: Average amount spent per order (total_order_value / total_order_count)
      - name: total_order_count
        logicalType: integer
        description: Total number of orders across customer lifetime
      - name: total_order_value
        logicalType: number
        description: Total amount spent across customer lifetime
      - name: first_order_date
        logicalType: timestamp
        description: Date and time of customer's first order (YYYY-MM-DD HH:mm:ss)
      - name: last_order_date
        logicalType: timestamp
        description: Date and time of customer's most recent order
      - name: rank
        logicalType: integer
        description: Numeric ranking of customer lifetime value relative to all customers
      - name: new
        logicalType: boolean
        description: True if customer made first order in last 30 days
      - name: returning
        logicalType: boolean
        description: True if customer has made more than one order
      - name: loyal
        logicalType: boolean
        description: True if customer has high return probability and above-average orders
      - name: at_risk
        logicalType: boolean
        description: True for repeat customers with medium return probability
      - name: dormant
        logicalType: boolean
        description: True if customer has very low probability of returning
slaProperties:
  - property: freshness
    value: "6"
    unit: hours
    description: Customer data should be refreshed every 6 hours
  - property: availability
    value: "99.9"
    unit: percent
quality:
  - type: custom
    name: no_null_customer_ids
    description: Customer ID should never be null
    column: customer_id
    rule: "customer_id IS NOT NULL"
    severity: critical
  - type: library
    name: valid_order_counts
    description: Order count should be non-negative
    column: total_order_count
    rule: nullValues
    severity: warning
team:
  - username: analytics_team
    role: owner
    description: Analytics team responsible for customer data
roles:
  - role: data_analyst
    access: read
    description: Read access for analysts
  - role: data_engineer
    access: readWrite
    description: Full access for data engineers
